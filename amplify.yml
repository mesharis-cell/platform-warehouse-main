version: 1
frontend:
    phases:
        preBuild:
            commands:
                - 'curl -fsSL https://bun.sh/install | bash'
                - 'export PATH="$HOME/.bun/bin:$PATH"'
                - 'test ! -f pnpm-lock.yaml && test ! -f package-lock.json || (echo "Lockfile policy violation: use bun.lock only" && exit 1)'
                - 'bun install --frozen-lockfile'
        build:
            commands:
                - 'export PATH="$HOME/.bun/bin:$PATH"'
                - 'bun run build'
    artifacts:
        baseDirectory: .next
        files:
            - "**/*"
    cache:
        paths:
            - node_modules/**/*
            - .next/cache/**/*
